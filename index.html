<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <input type="file" value="Open" />
    <script type="module">
      import { get, set } from "https://cdn.jsdelivr.net/npm/idb-keyval@6/+esm";

      const extensions = [
        "psd",
        "psb",
        "png",
        "jpeg",
        "jpg",
        "tiff",
        "tif",
        "psdc",
        "heic",
        "heif",
        "webp",
      ]
        .map((ext) => `.${ext}`)
        .join();

      const btn = document.querySelector("button");
      btn.addEventListener("click", async () => {
        const input = document.createElement("input");
        input.type = "file";
        input.id = "browser-file-picker";
        input.accept = extensions;
        document.body.appendChild(input);

        const fileHandles = await new Promise((resolve) => {
          input.addEventListener("change", (event) => {
            const target = event.target;
            const fileList = target.files;
            resolve(fileList);
          });

          input.click();
        });

        const files = Array.from(fileHandles);

        input.remove();
        await set("idb-files", files);

        const url = new URL("new", window.location.href);
        window.open(url.href, "_blank", "noopener")?.focus();
      // });
    </script>
  </body>
</html>
